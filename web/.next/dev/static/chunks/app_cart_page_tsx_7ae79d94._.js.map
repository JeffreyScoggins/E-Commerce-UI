{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/jeff/Code/E-Commerce-UI/web/app/cart/page.tsx"],"sourcesContent":["\"use client\";\n\nimport Link from \"next/link\";\nimport { useEffect, useMemo, useState } from \"react\";\nimport { useRouter } from \"next/navigation\";\n\ntype CartItem = {\n  id: number;\n  quantity: number;\n  product: {\n    id: number;\n    name: string;\n    price_cents: number;\n    currency: string;\n    image_url?: string | null;\n  };\n};\n\ntype Cart = {\n  id: number;\n  items: CartItem[];\n};\n\nfunction money(cents: number, currency: string) {\n  return new Intl.NumberFormat(\"en-US\", {\n    style: \"currency\",\n    currency: currency || \"USD\",\n  }).format(cents / 100);\n}\n\nexport default function CartPage() {\n  const router = useRouter();\n  const [cart, setCart] = useState<Cart | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [err, setErr] = useState<string>(\"\");\n\n  const subtotalCents = useMemo(() => {\n    if (!cart) return 0;\n    return cart.items.reduce((sum, it) => sum + it.quantity * it.product.price_cents, 0);\n  }, [cart]);\n\n  const currency = cart?.items?.[0]?.product?.currency ?? \"USD\";\n\n  async function loadCart() {\n    setErr(\"\");\n    setLoading(true);\n    try {\n      const res = await fetch(\"/api/cart\", { cache: \"no-store\" });\n      if (res.status === 401) {\n        router.replace(\"/login\");\n        return;\n      }\n      if (!res.ok) throw new Error(`Failed to load cart: ${res.status}`);\n      const data = (await res.json()) as Cart;\n      setCart(data);\n    } catch (e: any) {\n      setErr(e?.message ?? \"Failed to load cart.\");\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  useEffect(() => {\n    loadCart();\n  }, []);\n\n  async function updateQty(itemId: number, nextQty: number) {\n    if (!cart) return;\n\n    // Optimistic update\n    const prev = cart;\n    setCart({\n      ...cart,\n      items: cart.items.map((it) => (it.id === itemId ? { ...it, quantity: nextQty } : it)),\n    });\n\n    try {\n      const res = await fetch(\"/api/cart/items\", {\n        method: \"PATCH\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ item_id: itemId, quantity: nextQty }),\n      });\n      if (res.status === 401) {\n        router.replace(\"/login\");\n        return;\n      }\n      if (!res.ok) throw new Error(\"Update failed.\");\n      // Optionally re-fetch to keep totals consistent with backend\n      await loadCart();\n    } catch {\n      setCart(prev);\n      setErr(\"Could not update quantity.\");\n    }\n  }\n\n  async function removeItem(itemId: number) {\n    if (!cart) return;\n\n    const prev = cart;\n    setCart({ ...cart, items: cart.items.filter((it) => it.id !== itemId) });\n\n    try {\n      const res = await fetch(\"/api/cart/items\", {\n        method: \"DELETE\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ item_id: itemId }),\n      });\n      if (res.status === 401) {\n        router.replace(\"/login\");\n        return;\n      }\n      if (!res.ok) throw new Error(\"Remove failed.\");\n      await loadCart();\n    } catch {\n      setCart(prev);\n      setErr(\"Could not remove item.\");\n    }\n  }\n\n  if (loading) {\n    return (\n      <main className=\"min-h-screen\">\n        <section className=\"mx-auto max-w-5xl px-4 py-8\">\n          <h1 className=\"text-2xl font-semibold tracking-tight\">Cart</h1>\n          <p className=\"mt-4 text-sm text-zinc-600\">Loadingâ€¦</p>\n        </section>\n      </main>\n    );\n  }\n\n  return (\n    <main className=\"min-h-screen\">\n      <section className=\"mx-auto max-w-5xl px-4 py-8\">\n        <div className=\"flex items-end justify-between gap-4\">\n          <div>\n            <p className=\"text-sm text-black\">Cart</p>\n            <h1 className=\"text-2xl text-black font-semibold tracking-tight\">Your items</h1>\n          </div>\n          <Link\n            href=\"/\"\n            className=\"rounded-xl border bg-white px-3 py-2 text-sm text-black hover:bg-zinc-50\"\n          >\n            Continue shopping\n          </Link>\n        </div>\n\n        {err ? (\n          <div className=\"mt-6 rounded-xl bg-red-50 px-3 py-2 text-sm text-red-700\">\n            {err}\n          </div>\n        ) : null}\n\n        {!cart || cart.items.length === 0 ? (\n          <div className=\"mt-6 rounded-2xl border bg-white p-8 shadow-sm\">\n            <p className=\"text-sm text-black\">Your cart is empty.</p>\n            <p className=\"mt-2 text-sm text-black\">\n              Add a few items and they will show up here.\n            </p>\n            <Link\n              href=\"/\"\n              className=\"mt-4 inline-flex rounded-xl bg-zinc-900 px-4 py-2 text-sm font-medium text-white hover:bg-zinc-800\"\n            >\n              Browse products\n            </Link>\n          </div>\n        ) : (\n          <div className=\"mt-6 grid gap-6 lg:grid-cols-[1fr_360px]\">\n            <div className=\"rounded-2xl border bg-white shadow-sm\">\n              <div className=\"divide-y\">\n                {cart.items.map((it) => (\n                  <div key={it.id} className=\"p-5\">\n                    <div className=\"flex gap-4\">\n                      <div className=\"h-20 w-20 overflow-hidden rounded-xl bg-zinc-100\">\n                        {it.product.image_url ? (\n                          <img\n                            src={it.product.image_url}\n                            alt={it.product.name}\n                            className=\"h-full w-full object-cover\"\n                            loading=\"lazy\"\n                          />\n                        ) : null}\n                      </div>\n\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-start justify-between gap-3\">\n                          <div>\n                            <p className=\"text-sm font-semibold text-zinc-900\">\n                              {it.product.name}\n                            </p>\n                            <p className=\"mt-1 text-sm text-black\">\n                              {money(it.product.price_cents, it.product.currency)}\n                            </p>\n                          </div>\n\n                          <button\n                            onClick={() => removeItem(it.id)}\n                            className=\"text-sm text-black hover:text-zinc-900\"\n                          >\n                            Remove\n                          </button>\n                        </div>\n\n                        <div className=\"mt-4 flex items-center gap-3\">\n                          <button\n                            onClick={() => updateQty(it.id, Math.max(1, it.quantity - 1))}\n                            className=\"h-9 w-9 rounded-xl border bg-white text-black text-sm hover:bg-zinc-50\"\n                          >\n                            -\n                          </button>\n\n                          <span className=\"min-w-[32px] text-center text-black text-sm font-medium\">\n                            {it.quantity}\n                          </span>\n\n                          <button\n                            onClick={() => updateQty(it.id, it.quantity + 1)}\n                            className=\"h-9 w-9 rounded-xl border text-black bg-white text-sm hover:bg-zinc-50\"\n                          >\n                            +\n                          </button>\n\n                          <div className=\"ml-auto text-sm font-semibold text-zinc-900\">\n                            {money(it.quantity * it.product.price_cents, it.product.currency)}\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            <aside className=\"rounded-2xl border bg-white p-5 shadow-sm\">\n              <h2 className=\"text-sm font-semibold text-zinc-900\">Summary</h2>\n\n              <div className=\"mt-4 flex items-center justify-between text-sm\">\n                <span className=\"text-zinc-600\">Subtotal</span>\n                <span className=\"font-semibold text-zinc-900\">\n                  {money(subtotalCents, currency)}\n                </span>\n              </div>\n\n              <div className=\"mt-2 flex items-center justify-between text-sm\">\n                <span className=\"text-zinc-600\">Shipping</span>\n                <span className=\"text-zinc-900\">Calculated at checkout</span>\n              </div>\n\n              <div className=\"mt-5 border-t pt-4 flex items-center justify-between\">\n                <span className=\"text-sm text-zinc-600\">Total</span>\n                <span className=\"text-base font-semibold text-zinc-900\">\n                  {money(subtotalCents, currency)}\n                </span>\n              </div>\n\n              <button\n                className=\"mt-4 w-full rounded-xl bg-zinc-900 px-4 py-2 text-sm font-medium text-white hover:bg-zinc-800\"\n                onClick={() => alert(\"Next step: checkout\")}\n              >\n                Checkout\n              </button>\n\n              <p className=\"mt-3 text-xs text-zinc-500\">\n                Checkout can be Stripe later. This page already supports quantities and removals.\n              </p>\n            </aside>\n          </div>\n        )}\n      </section>\n    </main>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}