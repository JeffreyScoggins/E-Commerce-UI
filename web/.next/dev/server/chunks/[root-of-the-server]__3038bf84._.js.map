{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/jeff/Code/E-Commerce-UI/web/lib/serverAuth.ts"],"sourcesContent":["import { cookies } from \"next/headers\";\n\nconst ACCESS_COOKIE = \"access_token\";\nconst REFRESH_COOKIE = \"refresh_token\";\n\nexport async function getAccessToken(): Promise<string | undefined> {\n  const jar = await cookies();\n  return jar.get(ACCESS_COOKIE)?.value;\n}\n\nexport async function getRefreshToken(): Promise<string | undefined> {\n  const jar = await cookies();\n  return jar.get(REFRESH_COOKIE)?.value;\n}\n\nexport async function setAuthCookies(access: string, refresh: string) {\n  const jar = await cookies();\n\n  const base = {\n    httpOnly: true,\n    sameSite: \"lax\" as const,\n    path: \"/\",\n    secure: process.env.NODE_ENV === \"production\",\n  };\n\n  jar.set(ACCESS_COOKIE, access, { ...base, maxAge: 60 * 15 });\n  jar.set(REFRESH_COOKIE, refresh, { ...base, maxAge: 60 * 60 * 24 * 7 });\n}\n\nexport async function clearAuthCookies() {\n  const jar = await cookies();\n  jar.delete(ACCESS_COOKIE);\n  jar.delete(REFRESH_COOKIE);\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAEA,MAAM,gBAAgB;AACtB,MAAM,iBAAiB;AAEhB,eAAe;IACpB,MAAM,MAAM,MAAM,IAAA,4IAAO;IACzB,OAAO,IAAI,GAAG,CAAC,gBAAgB;AACjC;AAEO,eAAe;IACpB,MAAM,MAAM,MAAM,IAAA,4IAAO;IACzB,OAAO,IAAI,GAAG,CAAC,iBAAiB;AAClC;AAEO,eAAe,eAAe,MAAc,EAAE,OAAe;IAClE,MAAM,MAAM,MAAM,IAAA,4IAAO;IAEzB,MAAM,OAAO;QACX,UAAU;QACV,UAAU;QACV,MAAM;QACN,QAAQ,oDAAyB;IACnC;IAEA,IAAI,GAAG,CAAC,eAAe,QAAQ;QAAE,GAAG,IAAI;QAAE,QAAQ,KAAK;IAAG;IAC1D,IAAI,GAAG,CAAC,gBAAgB,SAAS;QAAE,GAAG,IAAI;QAAE,QAAQ,KAAK,KAAK,KAAK;IAAE;AACvE;AAEO,eAAe;IACpB,MAAM,MAAM,MAAM,IAAA,4IAAO;IACzB,IAAI,MAAM,CAAC;IACX,IAAI,MAAM,CAAC;AACb"}},
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///home/jeff/Code/E-Commerce-UI/web/app/api/cart/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport {\n  getAccessToken,\n  getRefreshToken,\n  setAuthCookies,\n  clearAuthCookies,\n} from \"@/lib/serverAuth\";\n\nasync function refreshAccess(base: string, refresh: string) {\n  const r = await fetch(`${base}/auth/refresh/`, {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ refresh }),\n    cache: \"no-store\",\n  });\n  const data = await r.json().catch(() => ({}));\n  if (!r.ok || !data?.access) return null;\n  return data.access as string;\n}\n\nasync function djangoAuthedFetch(path: string, init: RequestInit) {\n  const base = process.env.DJANGO_API_BASE ?? \"http://127.0.0.1:8000/api\";\n  let access = await getAccessToken();\n  const refresh = await getRefreshToken();\n\n  if (!access) return { status: 401, json: { detail: \"Unauthorized\" } };\n\n  let res = await fetch(`${base}${path}`, {\n    ...init,\n    headers: { ...(init.headers || {}), Authorization: `Bearer ${access}` },\n    cache: \"no-store\",\n  });\n\n  if (res.status === 401 && refresh) {\n    const newAccess = await refreshAccess(base, refresh);\n    if (!newAccess) {\n      await clearAuthCookies();\n      return { status: 401, json: { detail: \"Unauthorized\" } };\n    }\n    await setAuthCookies(newAccess, refresh);\n    access = newAccess;\n\n    res = await fetch(`${base}${path}`, {\n      ...init,\n      headers: { ...(init.headers || {}), Authorization: `Bearer ${access}` },\n      cache: \"no-store\",\n    });\n  }\n\n  const json = await res.json().catch(() => ({}));\n  return { status: res.status, json };\n}\n\nexport async function GET() {\n  // Django should implement GET /api/cart/ returning cart + items\n  const out = await djangoAuthedFetch(\"/cart/\", { method: \"GET\" });\n  return NextResponse.json(out.json, { status: out.status });\n}\n\nexport async function DELETE() {\n  // Optional: Django can implement DELETE /api/cart/ to clear\n  const out = await djangoAuthedFetch(\"/cart/\", { method: \"DELETE\" });\n  return NextResponse.json(out.json, { status: out.status });\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAOA,eAAe,cAAc,IAAY,EAAE,OAAe;IACxD,MAAM,IAAI,MAAM,MAAM,GAAG,KAAK,cAAc,CAAC,EAAE;QAC7C,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;YAAE;QAAQ;QAC/B,OAAO;IACT;IACA,MAAM,OAAO,MAAM,EAAE,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;IAC3C,IAAI,CAAC,EAAE,EAAE,IAAI,CAAC,MAAM,QAAQ,OAAO;IACnC,OAAO,KAAK,MAAM;AACpB;AAEA,eAAe,kBAAkB,IAAY,EAAE,IAAiB;IAC9D,MAAM,OAAO,QAAQ,GAAG,CAAC,eAAe,IAAI;IAC5C,IAAI,SAAS,MAAM,IAAA,qIAAc;IACjC,MAAM,UAAU,MAAM,IAAA,sIAAe;IAErC,IAAI,CAAC,QAAQ,OAAO;QAAE,QAAQ;QAAK,MAAM;YAAE,QAAQ;QAAe;IAAE;IAEpE,IAAI,MAAM,MAAM,MAAM,GAAG,OAAO,MAAM,EAAE;QACtC,GAAG,IAAI;QACP,SAAS;YAAE,GAAI,KAAK,OAAO,IAAI,CAAC,CAAC;YAAG,eAAe,CAAC,OAAO,EAAE,QAAQ;QAAC;QACtE,OAAO;IACT;IAEA,IAAI,IAAI,MAAM,KAAK,OAAO,SAAS;QACjC,MAAM,YAAY,MAAM,cAAc,MAAM;QAC5C,IAAI,CAAC,WAAW;YACd,MAAM,IAAA,uIAAgB;YACtB,OAAO;gBAAE,QAAQ;gBAAK,MAAM;oBAAE,QAAQ;gBAAe;YAAE;QACzD;QACA,MAAM,IAAA,qIAAc,EAAC,WAAW;QAChC,SAAS;QAET,MAAM,MAAM,MAAM,GAAG,OAAO,MAAM,EAAE;YAClC,GAAG,IAAI;YACP,SAAS;gBAAE,GAAI,KAAK,OAAO,IAAI,CAAC,CAAC;gBAAG,eAAe,CAAC,OAAO,EAAE,QAAQ;YAAC;YACtE,OAAO;QACT;IACF;IAEA,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;IAC7C,OAAO;QAAE,QAAQ,IAAI,MAAM;QAAE;IAAK;AACpC;AAEO,eAAe;IACpB,gEAAgE;IAChE,MAAM,MAAM,MAAM,kBAAkB,UAAU;QAAE,QAAQ;IAAM;IAC9D,OAAO,gJAAY,CAAC,IAAI,CAAC,IAAI,IAAI,EAAE;QAAE,QAAQ,IAAI,MAAM;IAAC;AAC1D;AAEO,eAAe;IACpB,4DAA4D;IAC5D,MAAM,MAAM,MAAM,kBAAkB,UAAU;QAAE,QAAQ;IAAS;IACjE,OAAO,gJAAY,CAAC,IAAI,CAAC,IAAI,IAAI,EAAE;QAAE,QAAQ,IAAI,MAAM;IAAC;AAC1D"}}]
}