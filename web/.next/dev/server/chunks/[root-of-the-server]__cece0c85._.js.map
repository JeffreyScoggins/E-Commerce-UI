{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///home/jeff/Code/E-Commerce-UI/web/lib/serverAuth.ts"],"sourcesContent":["import { cookies } from \"next/headers\";\n\nconst ACCESS_COOKIE = \"access_token\";\nconst REFRESH_COOKIE = \"refresh_token\";\n\nexport async function getAccessToken(): Promise<string | undefined> {\n  const jar = await cookies();\n  return jar.get(ACCESS_COOKIE)?.value;\n}\n\nexport async function getRefreshToken(): Promise<string | undefined> {\n  const jar = await cookies();\n  return jar.get(REFRESH_COOKIE)?.value;\n}\n\nexport async function setAuthCookies(access: string, refresh: string) {\n  const jar = await cookies();\n\n  const base = {\n    httpOnly: true,\n    sameSite: \"lax\" as const,\n    path: \"/\",\n    secure: process.env.NODE_ENV === \"production\",\n  };\n\n  jar.set(ACCESS_COOKIE, access, { ...base, maxAge: 60 * 15 });\n  jar.set(REFRESH_COOKIE, refresh, { ...base, maxAge: 60 * 60 * 24 * 7 });\n}\n\nexport async function clearAuthCookies() {\n  const jar = await cookies();\n  jar.delete(ACCESS_COOKIE);\n  jar.delete(REFRESH_COOKIE);\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;AAEA,MAAM,gBAAgB;AACtB,MAAM,iBAAiB;AAEhB,eAAe;IACpB,MAAM,MAAM,MAAM,IAAA,4IAAO;IACzB,OAAO,IAAI,GAAG,CAAC,gBAAgB;AACjC;AAEO,eAAe;IACpB,MAAM,MAAM,MAAM,IAAA,4IAAO;IACzB,OAAO,IAAI,GAAG,CAAC,iBAAiB;AAClC;AAEO,eAAe,eAAe,MAAc,EAAE,OAAe;IAClE,MAAM,MAAM,MAAM,IAAA,4IAAO;IAEzB,MAAM,OAAO;QACX,UAAU;QACV,UAAU;QACV,MAAM;QACN,QAAQ,oDAAyB;IACnC;IAEA,IAAI,GAAG,CAAC,eAAe,QAAQ;QAAE,GAAG,IAAI;QAAE,QAAQ,KAAK;IAAG;IAC1D,IAAI,GAAG,CAAC,gBAAgB,SAAS;QAAE,GAAG,IAAI;QAAE,QAAQ,KAAK,KAAK,KAAK;IAAE;AACvE;AAEO,eAAe;IACpB,MAAM,MAAM,MAAM,IAAA,4IAAO;IACzB,IAAI,MAAM,CAAC;IACX,IAAI,MAAM,CAAC;AACb"}},
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///home/jeff/Code/E-Commerce-UI/web/app/api/products/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport {\n  getAccessToken,\n  getRefreshToken,\n  setAuthCookies,\n  clearAuthCookies,\n} from \"@/lib/serverAuth\";\n\nasync function refreshAccessToken(base: string, refresh: string) {\n  const res = await fetch(`${base}/auth/refresh/`, {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ refresh }),\n    cache: \"no-store\",\n  });\n\n  const data = await res.json().catch(() => ({}));\n  if (!res.ok || !data?.access) return null;\n  return data.access as string;\n}\n\nexport async function GET() {\n  const base = process.env.DJANGO_API_BASE ?? \"http://127.0.0.1:8000/api\";\n\n  let access = await getAccessToken();\n  const refresh = await getRefreshToken();\n\n  if (!access) {\n    return NextResponse.json({ detail: \"Unauthorized (no cookie)\" }, { status: 401 });\n  }\n\n  let res = await fetch(`${base}/products/`, {\n    headers: { Authorization: `Bearer ${access}` },\n    cache: \"no-store\",\n  });\n\n  if (res.status === 401 && refresh) {\n    const newAccess = await refreshAccessToken(base, refresh);\n    if (!newAccess) {\n      await clearAuthCookies();\n      return NextResponse.json({ detail: \"Unauthorized (refresh failed)\" }, { status: 401 });\n    }\n\n    await setAuthCookies(newAccess, refresh);\n    access = newAccess;\n\n    res = await fetch(`${base}/products/`, {\n      headers: { Authorization: `Bearer ${access}` },\n      cache: \"no-store\",\n    });\n  }\n\n  const data = await res.json().catch(() => ({}));\n  return NextResponse.json(data, { status: res.status });\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAOA,eAAe,mBAAmB,IAAY,EAAE,OAAe;IAC7D,MAAM,MAAM,MAAM,MAAM,GAAG,KAAK,cAAc,CAAC,EAAE;QAC/C,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;YAAE;QAAQ;QAC/B,OAAO;IACT;IAEA,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;IAC7C,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,MAAM,QAAQ,OAAO;IACrC,OAAO,KAAK,MAAM;AACpB;AAEO,eAAe;IACpB,MAAM,OAAO,QAAQ,GAAG,CAAC,eAAe,IAAI;IAE5C,IAAI,SAAS,MAAM,IAAA,qIAAc;IACjC,MAAM,UAAU,MAAM,IAAA,sIAAe;IAErC,IAAI,CAAC,QAAQ;QACX,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,QAAQ;QAA2B,GAAG;YAAE,QAAQ;QAAI;IACjF;IAEA,IAAI,MAAM,MAAM,MAAM,GAAG,KAAK,UAAU,CAAC,EAAE;QACzC,SAAS;YAAE,eAAe,CAAC,OAAO,EAAE,QAAQ;QAAC;QAC7C,OAAO;IACT;IAEA,IAAI,IAAI,MAAM,KAAK,OAAO,SAAS;QACjC,MAAM,YAAY,MAAM,mBAAmB,MAAM;QACjD,IAAI,CAAC,WAAW;YACd,MAAM,IAAA,uIAAgB;YACtB,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,QAAQ;YAAgC,GAAG;gBAAE,QAAQ;YAAI;QACtF;QAEA,MAAM,IAAA,qIAAc,EAAC,WAAW;QAChC,SAAS;QAET,MAAM,MAAM,MAAM,GAAG,KAAK,UAAU,CAAC,EAAE;YACrC,SAAS;gBAAE,eAAe,CAAC,OAAO,EAAE,QAAQ;YAAC;YAC7C,OAAO;QACT;IACF;IAEA,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;IAC7C,OAAO,gJAAY,CAAC,IAAI,CAAC,MAAM;QAAE,QAAQ,IAAI,MAAM;IAAC;AACtD"}}]
}